import{r as t,h as P}from"./iframe-B1MrCL0G.js";import"./jsx-runtime-u17CrQMm.js";import{u as $,i as I}from"./floating-ui.react-dom-DvM99rDh.js";import"./index-BxOsspT5.js";var b=typeof document<"u",w=function(){},S=b?t.useLayoutEffect:w;const D={...P},O=D.useInsertionEffect,B=O||(e=>e());function N(e){const n=t.useRef(()=>{});return B(()=>{n.current=e}),t.useCallback(function(){for(var c=arguments.length,o=new Array(c),u=0;u<c;u++)o[u]=arguments[u];return n.current==null?void 0:n.current(...o)},[])}const T={...P};let M=!1,A=0;const F=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+A++;function H(){const[e,n]=t.useState(()=>M?F():void 0);return S(()=>{e==null&&n(F())},[]),t.useEffect(()=>{M=!0},[]),e}const L=T.useId,_=L||H;function j(){const e=new Map;return{emit(n,c){var o;(o=e.get(n))==null||o.forEach(u=>u(c))},on(n,c){e.has(n)||e.set(n,new Set),e.get(n).add(c)},off(n,c){var o;(o=e.get(n))==null||o.delete(c)}}}const k=t.createContext(null),q=t.createContext(null),y=()=>{var e;return((e=t.useContext(k))==null?void 0:e.id)||null},z=()=>t.useContext(q);function G(e){const{open:n=!1,onOpenChange:c,elements:o}=e,u=_(),R=t.useRef({}),[a]=t.useState(()=>j()),g=y()!=null,[C,h]=t.useState(o.reference),f=N((s,i,d)=>{R.current.openEvent=s?i:void 0,a.emit("openchange",{open:s,event:i,reason:d,nested:g}),c?.(s,i,d)}),l=t.useMemo(()=>({setPositionReference:h}),[]),m=t.useMemo(()=>({reference:C||o.reference||null,floating:o.floating||null,domReference:o.reference}),[C,o.reference,o.floating]);return t.useMemo(()=>({dataRef:R,open:n,onOpenChange:f,elements:m,events:a,floatingId:u,refs:l}),[n,f,m,a,u,l])}function V(e){e===void 0&&(e={});const{nodeId:n}=e,c=G({...e,elements:{reference:null,floating:null,...e.elements}}),o=e.rootContext||c,u=o.elements,[R,a]=t.useState(null),[g,C]=t.useState(null),f=u?.domReference||R,l=t.useRef(null),m=z();S(()=>{f&&(l.current=f)},[f]);const s=$({...e,elements:{...u,...g&&{reference:g}}}),i=t.useCallback(r=>{const E=I(r)?{getBoundingClientRect:()=>r.getBoundingClientRect(),getClientRects:()=>r.getClientRects(),contextElement:r}:r;C(E),s.refs.setReference(E)},[s.refs]),d=t.useCallback(r=>{(I(r)||r===null)&&(l.current=r,a(r)),(I(s.refs.reference.current)||s.refs.reference.current===null||r!==null&&!I(r))&&s.refs.setReference(r)},[s.refs]),p=t.useMemo(()=>({...s.refs,setReference:d,setPositionReference:i,domReference:l}),[s.refs,d,i]),x=t.useMemo(()=>({...s.elements,domReference:f}),[s.elements,f]),v=t.useMemo(()=>({...s,...o,refs:p,elements:x,nodeId:n}),[s,p,x,n,o]);return S(()=>{o.dataRef.current.floatingContext=v;const r=m?.nodesRef.current.find(E=>E.id===n);r&&(r.context=v)}),t.useMemo(()=>({...s,context:v,refs:p,elements:x}),[s,p,x,v])}export{V as u};
